<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ICC from variance components • Agree</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ICC from variance components">
<meta property="og:description" content="Agree">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Agree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dichotomous.html">Agreement for dichotomous outcomes</a>
    </li>
    <li>
      <a href="../articles/icc_varcomp.html">ICC from variance components</a>
    </li>
    <li>
      <a href="../articles/polytomous.html">Agreement for polytomous outcomes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://iriseekhout.com/#r" class="external-link">
    <span class="fa fa-arrow-circle-left fa-lg"></span>
     
    Go back to main site
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ICC from variance components</h1>
                        <h4 data-toc-skip class="author">Iris Eekhout
&amp; Wieneke Mokkink</h4>
            
            <h4 data-toc-skip class="date">2022-09-12</h4>
      
      
      <div class="hidden name"><code>icc_varcomp.Rmd</code></div>

    </div>

    
    
<p>This Document describes the computational background and the use of
the <code><a href="../reference/icc.html">icc()</a></code> function from the <code>Agree</code> package. We
developed the <code><a href="../reference/icc.html">icc()</a></code> functions for this package in
connection with a simulation study about sample size requirements for
studies on reliability and measurement error <span class="citation">Mokkink, de Vet, and Eekhout (2022a)</span> and a
methodological paper about how to design and conduct a study on
reliability and measurement error <span class="citation">Mokkink, de
Vet, and Eekhout (2022b)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Agree)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> Attaching package<span class="sc">:</span> <span class="st">'Agree'</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> The following object is masked from <span class="st">'package:base'</span><span class="sc">:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span>     kappa</span></code></pre></div>
<div class="section level2">
<h2 id="data-example">Data example<a class="anchor" aria-label="anchor" href="#data-example"></a>
</h2>
<div class="section level3">
<h3 id="breast">Breast<a class="anchor" aria-label="anchor" href="#breast"></a>
</h3>
<p>The intra-class agreement is usually obtained for continuous ratings.
As an example we can use data from data study by <span class="citation">Dikmans et al. (2017)</span>. This data is based on
photographs of breasts of 50 women after breast reconstruction. The
photographs are independently scored by 5 surgeons, the patients, and
three mammography nurses. They each rated the quality of the
reconstruction on a 5 point ordinal scale with the verbal anchors on the
left side ‘very dissatisfied’ on the left end and on the right end ‘very
satisfied’ on the right end. They specifically rated the volume, shape,
symmetry, scars and nipple. For the <code>icc</code> examples we can use
the sum scores for volume, shape, symmetry, scars and nipple as an
overall rating from each rater.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>breast_scores <span class="ot">&lt;-</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Agree<span class="sc">::</span>breast <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Patient_score, PCH1_score, PCH2_score, PCH3_score, PCH4_score, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                PCH5_score, Mam1_score, Mam2_score, Mam3_score)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(breast_scores)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>   Patient_score PCH1_score PCH2_score PCH3_score PCH4_score PCH5_score</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span>          <span class="fl">10.0</span>          <span class="dv">9</span>          <span class="dv">9</span>          <span class="dv">8</span>        <span class="fl">7.0</span>          <span class="dv">8</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">2</span>            <span class="cn">NA</span>          <span class="dv">7</span>         <span class="cn">NA</span>         <span class="cn">NA</span>        <span class="fl">8.0</span>          <span class="dv">7</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">3</span>           <span class="fl">5.5</span>          <span class="dv">8</span>          <span class="dv">7</span>          <span class="dv">7</span>        <span class="fl">7.0</span>          <span class="dv">8</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">4</span>           <span class="fl">7.0</span>         <span class="cn">NA</span>          <span class="dv">5</span>          <span class="dv">4</span>        <span class="fl">4.0</span>          <span class="dv">8</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">5</span>           <span class="fl">1.0</span>          <span class="dv">1</span>          <span class="dv">2</span>          <span class="dv">2</span>        <span class="fl">3.0</span>          <span class="dv">1</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">6</span>           <span class="fl">8.0</span>          <span class="dv">8</span>          <span class="dv">7</span>         <span class="cn">NA</span>        <span class="fl">7.5</span>          <span class="dv">8</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>   Mam1_score Mam2_score Mam3_score</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span>          <span class="dv">8</span>          <span class="dv">8</span>          <span class="dv">8</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">2</span>          <span class="dv">9</span>          <span class="dv">7</span>         <span class="cn">NA</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">3</span>          <span class="dv">8</span>         <span class="cn">NA</span>          <span class="dv">7</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">4</span>         <span class="cn">NA</span>          <span class="dv">5</span>         <span class="cn">NA</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">5</span>          <span class="dv">3</span>          <span class="dv">3</span>          <span class="dv">4</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">6</span>          <span class="dv">9</span>          <span class="dv">7</span>          <span class="dv">7</span></span></code></pre></div>
<p>The example data shows missings. The <code>icc</code> function can
deal with these missings, because a mixed model is used to estimate the
variances to compute the icc with.</p>
<p>For a mixed model, the data needs to be restructured to a long
format. we can use the <code>pivot_longer()</code> function from the
<code>tidyr</code> package to do that:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>breast_long <span class="ot">&lt;-</span> breast_scores <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(breast_scores)) <span class="sc">%&gt;%</span> <span class="co">#add id column</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>id, <span class="at">names_to =</span> <span class="st">"rater"</span>, <span class="at">values_to =</span> <span class="st">"score"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>breast_long</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="co"># A tibble: 450 x 3 [39m</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>       id rater         score</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>     [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>int<span class="sc">&gt;</span> [39m [23m  [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>chr<span class="sc">&gt;</span> [39m [23m          [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [39m [23m</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m <span class="dv">1</span> [39m     <span class="dv">1</span> Patient_score    <span class="dv">10</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m <span class="dv">2</span> [39m     <span class="dv">1</span> PCH1_score        <span class="dv">9</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m <span class="dv">3</span> [39m     <span class="dv">1</span> PCH2_score        <span class="dv">9</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m <span class="dv">4</span> [39m     <span class="dv">1</span> PCH3_score        <span class="dv">8</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m <span class="dv">5</span> [39m     <span class="dv">1</span> PCH4_score        <span class="dv">7</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m <span class="dv">6</span> [39m     <span class="dv">1</span> PCH5_score        <span class="dv">8</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m <span class="dv">7</span> [39m     <span class="dv">1</span> Mam1_score        <span class="dv">8</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m <span class="dv">8</span> [39m     <span class="dv">1</span> Mam2_score        <span class="dv">8</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m <span class="dv">9</span> [39m     <span class="dv">1</span> Mam3_score        <span class="dv">8</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;250m10 [39m     <span class="dv">2</span> Patient_score     [31mNA [39m</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="co"># ... with 440 more rows [39m</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="co"># i Use `print(n = ...)` to see more rows [39m</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="variance-components">Variance components<a class="anchor" aria-label="anchor" href="#variance-components"></a>
</h2>
<p>The variances that are used to compute the <code>icc</code> are
obtained from a linear mixed model. This model is estimated with the
<code>lmer()</code> function from the <code>lme4</code> package. In the
<code>breast</code> example we have two levels: patients are level 1 and
raters/observers are level 2. The two-level multilevel model is defined
as <span class="math inline">\(Y_{ijr} = \beta_0 + b_{0j} + b_{0r} +
\epsilon_{ijr}\)</span>, where <span class="math inline">\(b_{0j}\)</span> is the random intercept at the
subject level and <span class="math inline">\(b_{0r}\)</span> the random
intercept at the rater/observer level. The <span class="math inline">\(\epsilon_{ijr}\)</span> is the residual error. The
<code>r-code</code> for the model in <code>lme4</code> is:
<code>lmer(score ~ (1|id) + (1|observer), data, REML = T)</code></p>
<p>De exact specification of the multilevel model, depends on the design
of the study and the type of ICC that one wants to compute.</p>
</div>
<div class="section level2">
<h2 id="types-of-icc">Types of ICC<a class="anchor" aria-label="anchor" href="#types-of-icc"></a>
</h2>
<p>There are three types of icc incorporated in the <code>icc</code>
function. The ICC oneway, ICC agreement and the ICC consistency.</p>
<div class="section level3">
<h3 id="icc-oneway">ICC oneway<a class="anchor" aria-label="anchor" href="#icc-oneway"></a>
</h3>
<p>The ICC type oneway is the variance between the subjects (<span class="math inline">\(\sigma^2_j\)</span>) divided by the sum of the
subject variance (<span class="math inline">\(\sigma^2_j\)</span>) and
the residual variance (<span class="math inline">\(\sigma^2_{\epsilon}\)</span>). The <span class="math inline">\(ICC_{oneway}\)</span> is computed as follows:</p>
<p><span class="math inline">\(ICC_{oneway} =
\frac{\sigma^2_j}{\sigma^2_j + \sigma^2_{\epsilon}}\)</span></p>
<p>The ICC oneway assumes that each subject is rated by a different set
of raters, that are randomly selected from a larger population of judges
(<span class="citation">Shrout and Fleis (1979)</span>). The
<code><a href="../reference/icc_oneway.html">icc_oneway()</a></code> uses the <code><a href="../reference/varcomp.html">varcomp()</a></code> function to
compute the variance components. These variances are estimated from a
<code>lmer</code> model with random slope for the subjects. <span class="math inline">\(Y_{ij} = \beta_0 + b_{0j} +
\epsilon_{ij}\)</span></p>
<p>The standard error of measurement (<span class="math inline">\(sem\)</span>) is the square root of the error
variance (i.e. <span class="math inline">\(sem =
\sigma^2_{\epsilon}\)</span>). The confidence intervals are computed
with the exact F method. <span class="math inline">\(F = \frac{k
\sigma^2_{j} + \sigma^2_{\epsilon}}{\sigma^2_{\epsilon}}\)</span>, with
<span class="math inline">\(df1 = n - 1\)</span> and <span class="math inline">\(df2 = n (k - 1)\)</span> (<span class="citation">Shrout and Fleis (1979)</span>).</p>
<p>For the oneway ICC, only the level 1, the patient level, is random.
The rater variance is not used.</p>
<p>The <code>r-code</code> to extract the variance component with the
<code>varcomp</code> function is:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varcomp</span>(score<span class="sc">~</span>(<span class="dv">1</span><span class="sc">|</span>id), <span class="at">data =</span> breast_long)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>               grp     vcov</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> id             id <span class="fl">2.051072</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Residual Residual <span class="fl">1.047193</span></span></code></pre></div>
<p>The variance components, can be used to compute the ICC oneway:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>vc <span class="ot">&lt;-</span> <span class="fu">varcomp</span>(score<span class="sc">~</span>(<span class="dv">1</span><span class="sc">|</span>id), <span class="at">data =</span> breast_long)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>vc[<span class="st">"id"</span>, <span class="st">"vcov"</span>]<span class="sc">/</span><span class="fu">sum</span>(vc[,<span class="st">"vcov"</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> [<span class="dv">1</span>] <span class="fl">0.6620067</span></span></code></pre></div>
<p>We have also incorporated a function that computed the ICC oneway
directly from the data in the wide format, using the same steps. This is
the <code>icc_oneway</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">icc_oneway</span>(breast_scores)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>         icc     L_icc     U_icc      sem varj_oneway varerr_oneway</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="fl">0.6620067</span> <span class="fl">0.5638296</span> <span class="fl">0.7598147</span> <span class="fl">1.023324</span>    <span class="fl">2.051072</span>      <span class="fl">1.047193</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="icc-agreement">ICC agreement<a class="anchor" aria-label="anchor" href="#icc-agreement"></a>
</h3>
<p>The icc type agreement is the variance between the subjects (<span class="math inline">\(\sigma^2_j\)</span>) divided by the sum of the
subject variance (<span class="math inline">\(\sigma^2_j\)</span>),
rater variance (<span class="math inline">\(\sigma^2_k\)</span>) and the
residual variance (<span class="math inline">\(\sigma^2_\epsilon\)</span>). The <span class="math inline">\(ICC_{agreement}\)</span> is computed as
follows:</p>
<p><span class="math inline">\(ICC_{agreement} =
\frac{\sigma^2_j}{\sigma^2_j + \sigma^2_k +
\sigma^2_{\epsilon}}\)</span></p>
<p>The ICC for agreement generalizes to other raters within a population
(<span class="citation">Shrout and Fleis (1979)</span>). All subjects
are rated by the same set of raters, and the rater variance is taken
into account in the calculation of the ICC. The variance components are
computed with the <code>icc_model()</code> function. This is a
<code>lmer</code> model with a random slope for the subjects and for the
raters. The <span class="math inline">\(sem\)</span> is the square root
of the sum of the rater variance and the error variance (i.e. <span class="math inline">\(sem = \sqrt{\sigma^2_r +
\sigma^2_\epsilon}\)</span>). The confidence intervals are approximated
to account for the three independent variance components, as defined by
<span class="citation">Satterthwaite (1946)</span> &amp; <span class="citation">Shrout and Fleis (1979)</span>.</p>
<p>For the ICC for agreement, both the level 1 and level 2 are
random.</p>
<p>The <code>r-code</code> to extract the variance component with the
<code>varcomp</code> function is:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varcomp</span>(score <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>id) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>rater), <span class="at">data =</span> breast_long)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>               grp      vcov</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> id             id <span class="fl">2.0069835</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> rater       rater <span class="fl">0.1167749</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Residual Residual <span class="fl">0.9424505</span></span></code></pre></div>
<p>The variance components, can be used to compute the ICC
agreement:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>vc <span class="ot">&lt;-</span> <span class="fu">varcomp</span>(score<span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>id) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>rater), <span class="at">data =</span> breast_long)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>vc[<span class="st">"id"</span>, <span class="st">"vcov"</span>]<span class="sc">/</span><span class="fu">sum</span>(vc[,<span class="st">"vcov"</span>])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> [<span class="dv">1</span>] <span class="fl">0.6545488</span></span></code></pre></div>
<p>We have also incorporated a function that computed the ICC for
agreement directly from the data in the wide format, using the same
steps. This is the <code>icc_agreement</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">icc_agreement</span>(breast_scores)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>         icc     L_icc   U_icc      sem varj_agr  varr_agr varerr_agr</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="fl">0.6545488</span> <span class="fl">0.5554292</span> <span class="fl">0.75384</span> <span class="fl">1.029187</span> <span class="fl">2.006984</span> <span class="fl">0.1167749</span>  <span class="fl">0.9424505</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="icc-consistency">ICC consistency<a class="anchor" aria-label="anchor" href="#icc-consistency"></a>
</h3>
<p>The ICC type consistency is the variance between the subjects (<span class="math inline">\(\sigma^2_j\)</span>) divided by the sum of the
subject variance (<span class="math inline">\(\sigma^2_j\)</span>) and
the residual variance (<span class="math inline">\(\sigma^2_\epsilon\)</span>). The rater variance is
not used to calculate the ICC and can therefore also be considered as a
fixed effect. The <span class="math inline">\(ICC_{consistency}\)</span>
is computed as follows:</p>
<p><span class="math inline">\(ICC_{consistency} =
\frac{\sigma^2_j}{\sigma^2_j + \sigma^2_{\epsilon}}\)</span></p>
<p>The ICC for consistency generalizes only to the set of raters in the
data (<span class="citation">Shrout and Fleis (1979)</span>). The
<code><a href="../reference/varcomp.html">varcomp()</a></code> function is used to compute the variance
components. These variances are computed from a a <code>lmer</code>
model with a random slope for the subjects and a fixed effect for the
raters. The sem is the square root of the error variance. The confidence
are computed with the exact F method. <span class="math inline">\(F =
\frac{(k \sigma^2_j + \sigma^2_\epsilon)}{\sigma^2_\epsilon}\)</span>,
with <span class="math inline">\(df1 = n - 1\)</span> and <span class="math inline">\(df2 = (n - 1) (k - 1)\)</span> (<span class="citation">Shrout and Fleis (1979)</span>).</p>
<p>For the ICC for consistency, the level 1 is a random effect and the
level 2 is fixed.</p>
<p>The <code>r-code</code> to extract the variance component with the
<code>varcomp</code> function is:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varcomp</span>(score <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>id) <span class="sc">+</span> rater, <span class="at">data =</span> breast_long)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>               grp      vcov</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> id             id <span class="fl">1.9956492</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Residual Residual <span class="fl">0.9428479</span></span></code></pre></div>
<p>The variance components, can be used to compute the ICC
consistency:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>vc <span class="ot">&lt;-</span> <span class="fu">varcomp</span>(score<span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>id) <span class="sc">+</span> rater, <span class="at">data =</span> breast_long)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>vc[<span class="st">"id"</span>, <span class="st">"vcov"</span>]<span class="sc">/</span><span class="fu">sum</span>(vc[,<span class="st">"vcov"</span>])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> [<span class="dv">1</span>] <span class="fl">0.6791394</span></span></code></pre></div>
<p>We have also incorporated a function that computed the ICC
consistency directly from the data in the wide format, using the same
steps. This is the <code>icc_consistency</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">icc_consistency</span>(breast_scores)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>         icc     L_icc     U_icc       sem varj_cons varerr_cons</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="fl">0.6791394</span> <span class="fl">0.5831551</span> <span class="fl">0.7734836</span> <span class="fl">0.9710035</span>  <span class="fl">1.995649</span>   <span class="fl">0.9428479</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparing-icc-types">Comparing ICC types<a class="anchor" aria-label="anchor" href="#comparing-icc-types"></a>
</h3>
<p>We have one general <code>icc</code> function that computes all three
ICC types for a data set. The differences in computations between the
ICC types can quickly be seen in the variance components returned by the
<code>icc</code> function. We can obtain the variances by using
<code>var = TRUE</code> in the <code><a href="../reference/icc.html">icc()</a></code> function, the
<code>var_level2</code> shows the variance between the raters. Only for
the ICC for agreement this variance component is estimated.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ICC for all methods</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">icc</span>(breast_scores, <span class="at">var =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>                   icc     lower     upper       sem var_level1 var_level2</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> oneway      <span class="fl">0.6620067</span> <span class="fl">0.5638296</span> <span class="fl">0.7598147</span> <span class="fl">1.0233245</span>   <span class="fl">2.051072</span>         <span class="cn">NA</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> agreement   <span class="fl">0.6545488</span> <span class="fl">0.5554292</span> <span class="fl">0.7538400</span> <span class="fl">1.0291868</span>   <span class="fl">2.006984</span>  <span class="fl">0.1167749</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> consistency <span class="fl">0.6791394</span> <span class="fl">0.5831551</span> <span class="fl">0.7734836</span> <span class="fl">0.9710035</span>   <span class="fl">1.995649</span>         <span class="cn">NA</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>             var_Residual</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> oneway         <span class="fl">1.0471930</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> agreement      <span class="fl">0.9424505</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> consistency    <span class="fl">0.9428479</span></span></code></pre></div>
<p>When we estimate the ICC for the surgeons only, we can see that the
variance at the rater level is decreased. This effect is directly shown
in the ICC.</p>
<p>In the icc we can also use the data in wide format and use the
<code>cols</code> option to define the rater columns that we want to
use.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ICC for all methods</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">icc</span>(breast_scores, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"PCH1_score"</span>, <span class="st">"PCH2_score"</span>, <span class="st">"PCH3_score"</span>, <span class="st">"PCH4_score"</span>, <span class="st">"PCH5_score"</span>), </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">var =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>                   icc     lower     upper       sem var_level1 var_level2</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> oneway      <span class="fl">0.7615871</span> <span class="fl">0.6710817</span> <span class="fl">0.8403886</span> <span class="fl">0.8591071</span>   <span class="fl">2.357677</span>         <span class="cn">NA</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> agreement   <span class="fl">0.7593693</span> <span class="fl">0.6682981</span> <span class="fl">0.8387870</span> <span class="fl">0.8611481</span>   <span class="fl">2.340225</span> <span class="fl">0.05026114</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> consistency <span class="fl">0.7711953</span> <span class="fl">0.6829366</span> <span class="fl">0.8473933</span> <span class="fl">0.8317713</span>   <span class="fl">2.331886</span>         <span class="cn">NA</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>             var_Residual</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> oneway         <span class="fl">0.7380650</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> agreement      <span class="fl">0.6913149</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> consistency    <span class="fl">0.6918435</span></span></code></pre></div>
<p>When we estimate the ICC for the mammography nurses only, we see that
the variance at the rater level is increased. This effect is directly
shown in the ICC.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ICC for all methods</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">icc</span>(breast_scores, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"Mam1_score"</span>, <span class="st">"Mam2_score"</span>, <span class="st">"Mam3_score"</span>), </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">var =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>                   icc     lower     upper       sem var_level1 var_level2</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> oneway      <span class="fl">0.6001478</span> <span class="fl">0.4493754</span> <span class="fl">0.7309390</span> <span class="fl">1.1515241</span>   <span class="fl">1.990237</span>         <span class="cn">NA</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> agreement   <span class="fl">0.5698257</span> <span class="fl">0.4137129</span> <span class="fl">0.7079019</span> <span class="fl">1.1919337</span>   <span class="fl">1.881923</span>  <span class="fl">0.4443499</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> consistency <span class="fl">0.6558989</span> <span class="fl">0.5162467</span> <span class="fl">0.7724701</span> <span class="fl">0.9899547</span>   <span class="fl">1.868020</span>         <span class="cn">NA</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>             var_Residual</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> oneway         <span class="fl">1.3260076</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> agreement      <span class="fl">0.9763561</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> consistency    <span class="fl">0.9800104</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="overview-technical-terms">Overview technical terms<a class="anchor" aria-label="anchor" href="#overview-technical-terms"></a>
</h2>
<table class="table">
<thead><tr class="header">
<th>Term</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\beta_0\)</span></td>
<td>Fixed intercept</td>
</tr>
<tr class="even">
<td><span class="math inline">\(b_{0j}\)</span></td>
<td>Random intercept at subject level</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(b_{0r}\)</span></td>
<td>Random intercept at rater level</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\epsilon_{ijr}\)</span></td>
<td>Residual error</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\sigma_j\)</span></td>
<td>Variance between subjects</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\sigma_r\)</span></td>
<td>Variance between raters</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\sigma_\epsilon\)</span></td>
<td>Residual error variance</td>
</tr>
<tr class="even">
<td><span class="math inline">\(k\)</span></td>
<td>Number of raters/observers</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(n\)</span></td>
<td>Number of subjects</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-dikmans2017" class="csl-entry">
Dikmans, R. E., L. Nene, M. B. Bouman, H. C. W. de Vet, M. Mireau, M. E.
Buncamper, H. Winters, M. Ritt, and M. G. Mullender. 2017. <span>“<a href="">The Aesthetic Items Scale: A Tool for the Evaluation of
Aesthetic Outcome After Breast Reconstruction</a>.”</span> <em>Plastic
and Reconstructive Surgery. Global Open.</em> 5 (3): e1254.
</div>
<div id="ref-mokkink1" class="csl-entry">
Mokkink, L., H. C. W. de Vet, and I Eekhout. 2022a. <span>“<a href="">Titel Paper 1</a>.”</span> <em>Tbd</em>.
</div>
<div id="ref-mokkink2" class="csl-entry">
———. 2022b. <span>“<a href="">Titel Paper 2</a>.”</span> <em>Tbd</em>.
</div>
<div id="ref-satter1946" class="csl-entry">
Satterthwaite, F. E. 1946. <span>“<a href="">An Approximate Distribution
of Estimates of Variance Components</a>.”</span> <em>Biometrics</em> 2:
110–14.
</div>
<div id="ref-shrout1979" class="csl-entry">
Shrout, P. E., and J. L. Fleis. 1979. <span>“<a href="">Intraclass
Correlations: Uses in Assessing Rater Reliability</a>.”</span>
<em>Psychologiclal Bulletin</em> 87 (2): 420–28.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Iris Eekhout.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
